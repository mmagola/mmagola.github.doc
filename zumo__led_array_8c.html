<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>My Project: D:/STUDIA/AGH/STUDIA/VI_SEMESTR/DoxygenFiles/source/zumo_ledArray.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('zumo__led_array_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">zumo_ledArray.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Library for Freescale KL46Z and Pololu Zumo Reflectance Sensor Array.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;MKL46Z4.h&quot;</code><br />
<code>#include &quot;<a class="el" href="zumo__led_array_8h_source.html">zumo_ledArray.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a59b28f0bbe153f9c2172066b437b4431"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zumo__led_array_8c.html#a59b28f0bbe153f9c2172066b437b4431">la_init</a> (void)</td></tr>
<tr class="memdesc:a59b28f0bbe153f9c2172066b437b4431"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function prepares LED array pins and LPTMR to work.  <a href="#a59b28f0bbe153f9c2172066b437b4431">More...</a><br /></td></tr>
<tr class="separator:a59b28f0bbe153f9c2172066b437b4431"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a32c7d6b84769f952cd6c7759209482ef"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zumo__led_array_8c.html#a32c7d6b84769f952cd6c7759209482ef">la_startCal</a> (void)</td></tr>
<tr class="memdesc:a32c7d6b84769f952cd6c7759209482ef"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function sets calibration flag.  <a href="#a32c7d6b84769f952cd6c7759209482ef">More...</a><br /></td></tr>
<tr class="separator:a32c7d6b84769f952cd6c7759209482ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a80842c42e85101e1d714a753aba9952a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zumo__led_array_8c.html#a80842c42e85101e1d714a753aba9952a">la_stopCal</a> (void)</td></tr>
<tr class="memdesc:a80842c42e85101e1d714a753aba9952a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function clears calibration flag.  <a href="#a80842c42e85101e1d714a753aba9952a">More...</a><br /></td></tr>
<tr class="separator:a80842c42e85101e1d714a753aba9952a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a337d6814f1a3b2d1d6b365d75c34e3ef"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zumo__led_array_8c.html#a337d6814f1a3b2d1d6b365d75c34e3ef">la_pins_init</a> (void)</td></tr>
<tr class="memdesc:a337d6814f1a3b2d1d6b365d75c34e3ef"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function prepares LED array pins (multiplexers, pull-up/pull-down resistors, NVIC)  <a href="#a337d6814f1a3b2d1d6b365d75c34e3ef">More...</a><br /></td></tr>
<tr class="separator:a337d6814f1a3b2d1d6b365d75c34e3ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a73600f9119563ff029a79b4a9d4d077f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zumo__led_array_8c.html#a73600f9119563ff029a79b4a9d4d077f">la_pins_as_inputs</a> (void)</td></tr>
<tr class="memdesc:a73600f9119563ff029a79b4a9d4d077f"><td class="mdescLeft">&#160;</td><td class="mdescRight">As the name suggests, function sets pins as inputs and enables interrupts.  <a href="#a73600f9119563ff029a79b4a9d4d077f">More...</a><br /></td></tr>
<tr class="separator:a73600f9119563ff029a79b4a9d4d077f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac9c0f431d82c25c370d7fad51661b211"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zumo__led_array_8c.html#ac9c0f431d82c25c370d7fad51661b211">la_pins_as_outputs_and_high</a> (void)</td></tr>
<tr class="memdesc:ac9c0f431d82c25c370d7fad51661b211"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function sets pins as outputs and disables interrupts.  <a href="#ac9c0f431d82c25c370d7fad51661b211">More...</a><br /></td></tr>
<tr class="separator:ac9c0f431d82c25c370d7fad51661b211"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7caaad9cec5c5d2faaadc1fee71db81f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zumo__led_array_8c.html#a7caaad9cec5c5d2faaadc1fee71db81f">lptimer_reload</a> (uint16_t time)</td></tr>
<tr class="memdesc:a7caaad9cec5c5d2faaadc1fee71db81f"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function resets LPTMR and set time value.  <a href="#a7caaad9cec5c5d2faaadc1fee71db81f">More...</a><br /></td></tr>
<tr class="separator:a7caaad9cec5c5d2faaadc1fee71db81f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6564668e00e247cccee27f78d4ee5741"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zumo__led_array_8c.html#a6564668e00e247cccee27f78d4ee5741">la_getLptmrCNR</a> (void)</td></tr>
<tr class="memdesc:a6564668e00e247cccee27f78d4ee5741"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function reads CNR register.  <a href="#a6564668e00e247cccee27f78d4ee5741">More...</a><br /></td></tr>
<tr class="separator:a6564668e00e247cccee27f78d4ee5741"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaecbd2d7dc60340959cb832b0a936b15"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zumo__led_array_8c.html#aaecbd2d7dc60340959cb832b0a936b15">la_calibrateMinMax</a> (volatile <a class="el" href="structla__sensor__t.html">la_sensor_t</a> *sensor_array)</td></tr>
<tr class="memdesc:aaecbd2d7dc60340959cb832b0a936b15"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function decides which colour is under each sensor (1 means dark/black)  <a href="#aaecbd2d7dc60340959cb832b0a936b15">More...</a><br /></td></tr>
<tr class="separator:aaecbd2d7dc60340959cb832b0a936b15"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b4e20e64ea6bb3d6632fe07585dbcd6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zumo__led_array_8c.html#a7b4e20e64ea6bb3d6632fe07585dbcd6">la_getPercentageReflectance</a> (int16_t *output_array)</td></tr>
<tr class="memdesc:a7b4e20e64ea6bb3d6632fe07585dbcd6"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function calculates relative 'surface reflectivity'.  <a href="#a7b4e20e64ea6bb3d6632fe07585dbcd6">More...</a><br /></td></tr>
<tr class="separator:a7b4e20e64ea6bb3d6632fe07585dbcd6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a14acac7e08664c3b6255ac7391eb09d4"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zumo__led_array_8c.html#a14acac7e08664c3b6255ac7391eb09d4">la_calculateSensorState</a> (volatile <a class="el" href="structla__sensor__t.html">la_sensor_t</a> *sensor_array)</td></tr>
<tr class="memdesc:a14acac7e08664c3b6255ac7391eb09d4"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function decides which colour is under each sensor (1 means dark/black)  <a href="#a14acac7e08664c3b6255ac7391eb09d4">More...</a><br /></td></tr>
<tr class="separator:a14acac7e08664c3b6255ac7391eb09d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abc6bc56488668d7ffba60574c1374144"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zumo__led_array_8c.html#abc6bc56488668d7ffba60574c1374144">la_getSensorState</a> (void)</td></tr>
<tr class="memdesc:abc6bc56488668d7ffba60574c1374144"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function returns status of each sensor.  <a href="#abc6bc56488668d7ffba60574c1374144">More...</a><br /></td></tr>
<tr class="separator:abc6bc56488668d7ffba60574c1374144"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1fa2da1558b73250cfb07ab3dedfcf1f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zumo__led_array_8c.html#a1fa2da1558b73250cfb07ab3dedfcf1f">LPTimer_IRQHandler</a> (void)</td></tr>
<tr class="memdesc:a1fa2da1558b73250cfb07ab3dedfcf1f"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function changes sensor pins direction. It works after charging sensor capacitors.  <a href="#a1fa2da1558b73250cfb07ab3dedfcf1f">More...</a><br /></td></tr>
<tr class="separator:a1fa2da1558b73250cfb07ab3dedfcf1f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae01b365de69142666b470757d24fae84"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zumo__led_array_8c.html#ae01b365de69142666b470757d24fae84">PORTA_IRQHandler</a> (void)</td></tr>
<tr class="memdesc:ae01b365de69142666b470757d24fae84"><td class="mdescLeft">&#160;</td><td class="mdescRight">Voltage drop function for two sensors.  <a href="#ae01b365de69142666b470757d24fae84">More...</a><br /></td></tr>
<tr class="separator:ae01b365de69142666b470757d24fae84"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a29e8c9a419cbde7a01f2d5664f59dce9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zumo__led_array_8c.html#a29e8c9a419cbde7a01f2d5664f59dce9">PORTC_PORTD_IRQHandler</a> (void)</td></tr>
<tr class="memdesc:a29e8c9a419cbde7a01f2d5664f59dce9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Voltage drop function for four sensors.  <a href="#a29e8c9a419cbde7a01f2d5664f59dce9">More...</a><br /></td></tr>
<tr class="separator:a29e8c9a419cbde7a01f2d5664f59dce9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:aac67b44fd8522f1794cc20210b6e30b9"><td class="memItemLeft" align="right" valign="top">volatile <a class="el" href="structla__sensor__t.html">la_sensor_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zumo__led_array_8c.html#aac67b44fd8522f1794cc20210b6e30b9">ledArr</a> [6]</td></tr>
<tr class="separator:aac67b44fd8522f1794cc20210b6e30b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a67a3e53e87d294ef560c6ab98805c51b"><td class="memItemLeft" align="right" valign="top">volatile char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zumo__led_array_8c.html#a67a3e53e87d294ef560c6ab98805c51b">la_state</a></td></tr>
<tr class="separator:a67a3e53e87d294ef560c6ab98805c51b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace4be061e8699df0061b24a48ccbbe3c"><td class="memItemLeft" align="right" valign="top">volatile uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zumo__led_array_8c.html#ace4be061e8699df0061b24a48ccbbe3c">measured</a> = 0</td></tr>
<tr class="separator:ace4be061e8699df0061b24a48ccbbe3c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a59dceca9de5c44458070062ca7a68c95"><td class="memItemLeft" align="right" valign="top">volatile uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zumo__led_array_8c.html#a59dceca9de5c44458070062ca7a68c95">cal_flag</a> = 0</td></tr>
<tr class="separator:a59dceca9de5c44458070062ca7a68c95"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac65cc9d437fc4e52a79dc15761c46f40"><td class="memItemLeft" align="right" valign="top">volatile uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="zumo__led_array_8c.html#ac65cc9d437fc4e52a79dc15761c46f40">valid_data</a> = 0</td></tr>
<tr class="separator:ac65cc9d437fc4e52a79dc15761c46f40"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Library for Freescale KL46Z and Pololu Zumo Reflectance Sensor Array. </p>
<p>Requirements (hardware and software): </p><ul>
<li>
Sensor pinout (from left): PTA4, PTC1, PTD6, PTC2, PTD3,PTA5. </li>
<li>
Disabled NMI. In startup_MKL46Z4.s (line 202) replace FOPT EQU 0xFF with FOPT EQU 0xFB </li>
<li>
CLOCK_SETUP in system_MKL46Z4.c equals 1 </li>
<li>
PEMicro soft in programmer. When there is CMSIS on PTC1 is always 'high' (probably pull-up resistor in programmer is not disabled). </li>
</ul>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a14acac7e08664c3b6255ac7391eb09d4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char la_calculateSensorState </td>
          <td>(</td>
          <td class="paramtype">volatile <a class="el" href="structla__sensor__t.html">la_sensor_t</a> *&#160;</td>
          <td class="paramname"><em>sensor_array</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function decides which colour is under each sensor (1 means dark/black) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sensor_array</td><td>Pointer to buffer structure </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Return value is byte with binary coded sensor state (last 6 bits, '1' means dark). </dd></dl>
<div class="fragment"><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                                                                   {</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    </div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="keywordtype">char</span> state = 0;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    uint8_t i;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    int16_t temp;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    </div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="keywordflow">for</span>(i=0; i&lt;6; i++){</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <span class="comment">// rotate left</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        state &lt;&lt;= 1;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        <span class="comment">// calculate reflectance</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        temp = 100 - (100 * ((sensor_array+i)-&gt;value - (sensor_array+i)-&gt;min) / ((sensor_array+i)-&gt;max - (sensor_array+i)-&gt;min));</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        <span class="comment">// if reflectance is smaller than </span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <span class="keywordflow">if</span>( temp &lt; <a class="code" href="zumo__led_array_8h.html#ab3f42dffd6994b926f0d3d19dcf501e6">LA_PERCENTAGE_SWITCHING_LEVEL</a> ) state |= 0x01;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    }</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="keywordflow">return</span> state;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;}</div>
<div class="ttc" id="zumo__led_array_8h_html_ab3f42dffd6994b926f0d3d19dcf501e6"><div class="ttname"><a href="zumo__led_array_8h.html#ab3f42dffd6994b926f0d3d19dcf501e6">LA_PERCENTAGE_SWITCHING_LEVEL</a></div><div class="ttdeci">#define LA_PERCENTAGE_SWITCHING_LEVEL</div><div class="ttdoc">Threshold between black and white colour. </div><div class="ttdef"><b>Definition:</b> zumo_ledArray.h:31</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aaecbd2d7dc60340959cb832b0a936b15"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void la_calibrateMinMax </td>
          <td>(</td>
          <td class="paramtype">volatile <a class="el" href="structla__sensor__t.html">la_sensor_t</a> *&#160;</td>
          <td class="paramname"><em>sensor_array</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function decides which colour is under each sensor (1 means dark/black) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sensor_array</td><td>Pointer to buffer structure </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Return value is byte with binary coded sensor state (last 6 bits, '1' means dark). </dd></dl>
<div class="fragment"><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                                                              {</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    </div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    uint8_t i;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="keywordflow">for</span>(i=0; i&lt;6; i++){</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        <span class="keywordflow">if</span>( (sensor_array+i)-&gt;value &gt; (sensor_array+i)-&gt;max ) (sensor_array+i)-&gt;max = (sensor_array+i)-&gt;value;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        <span class="keywordflow">if</span>( (sensor_array+i)-&gt;value &lt; (sensor_array+i)-&gt;min ) (sensor_array+i)-&gt;min = (sensor_array+i)-&gt;value;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    }</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a6564668e00e247cccee27f78d4ee5741"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t la_getLptmrCNR </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function reads CNR register. </p>
<p>We had to create this function because each reading of this register has to be preceded by writing something to it. </p><dl class="section return"><dt>Returns</dt><dd>Return value is number from LPTMR CNR </dd></dl>
<div class="fragment"><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                             {</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    </div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="comment">// Create a pinter to CNR register (Keil does not allow to write something to this register. In it&#39;s opinion it is read-only register)</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    uint32_t * point = (uint32_t*)0x4004000Cu;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    *point = 0;     <span class="comment">// Write something</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keywordflow">return</span> LPTMR0-&gt;CNR; <span class="comment">// Get valid data</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7b4e20e64ea6bb3d6632fe07585dbcd6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void la_getPercentageReflectance </td>
          <td>(</td>
          <td class="paramtype">int16_t *&#160;</td>
          <td class="paramname"><em>output_array</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function calculates relative 'surface reflectivity'. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">output_array</td><td>Pointer to destination array. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section warning"><dt>Warning</dt><dd>Output array has to have six elements. </dd></dl>
<div class="fragment"><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                                                          {</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    </div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    uint8_t i;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="keywordflow">for</span>(i=0; i&lt;6; i++){</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        *(output_array+i) = 100 - (100 * ((<a class="code" href="zumo__led_array_8c.html#aac67b44fd8522f1794cc20210b6e30b9">ledArr</a>+i)-&gt;value - (<a class="code" href="zumo__led_array_8c.html#aac67b44fd8522f1794cc20210b6e30b9">ledArr</a>+i)-&gt;min) / ((<a class="code" href="zumo__led_array_8c.html#aac67b44fd8522f1794cc20210b6e30b9">ledArr</a>+i)-&gt;max - (<a class="code" href="zumo__led_array_8c.html#aac67b44fd8522f1794cc20210b6e30b9">ledArr</a>+i)-&gt;min));</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    }</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;}</div>
<div class="ttc" id="zumo__led_array_8c_html_aac67b44fd8522f1794cc20210b6e30b9"><div class="ttname"><a href="zumo__led_array_8c.html#aac67b44fd8522f1794cc20210b6e30b9">ledArr</a></div><div class="ttdeci">volatile la_sensor_t ledArr[6]</div><div class="ttdef"><b>Definition:</b> zumo_ledArray.c:17</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="abc6bc56488668d7ffba60574c1374144"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char la_getSensorState </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function returns status of each sensor. </p>
<dl class="section return"><dt>Returns</dt><dd>Return value is byte with binary coded sensor state (last 6 bits, '1' means dark). </dd></dl>
<div class="fragment"><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                              {</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="keywordflow">while</span>( <a class="code" href="zumo__led_array_8c.html#ac65cc9d437fc4e52a79dc15761c46f40">valid_data</a> == 0 );   <span class="comment">// If data are changing, wait a while.</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="zumo__led_array_8c.html#a67a3e53e87d294ef560c6ab98805c51b">la_state</a>;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;}</div>
<div class="ttc" id="zumo__led_array_8c_html_a67a3e53e87d294ef560c6ab98805c51b"><div class="ttname"><a href="zumo__led_array_8c.html#a67a3e53e87d294ef560c6ab98805c51b">la_state</a></div><div class="ttdeci">volatile char la_state</div><div class="ttdef"><b>Definition:</b> zumo_ledArray.c:18</div></div>
<div class="ttc" id="zumo__led_array_8c_html_ac65cc9d437fc4e52a79dc15761c46f40"><div class="ttname"><a href="zumo__led_array_8c.html#ac65cc9d437fc4e52a79dc15761c46f40">valid_data</a></div><div class="ttdeci">volatile uint8_t valid_data</div><div class="ttdef"><b>Definition:</b> zumo_ledArray.c:21</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a59b28f0bbe153f9c2172066b437b4431"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void la_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function prepares LED array pins and LPTMR to work. </p>
<div class="fragment"><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;                  {</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    </div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    <a class="code" href="zumo__led_array_8c.html#a337d6814f1a3b2d1d6b365d75c34e3ef">la_pins_init</a>();</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    <a class="code" href="zumo__led_array_8c.html#ac9c0f431d82c25c370d7fad51661b211">la_pins_as_outputs_and_high</a>();</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    </div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    SIM-&gt;SCGC5 |= SIM_SCGC5_LPTMR_MASK;     <span class="comment">/*Turn on ADC Low Power Timer (LPTMR) registers clock gate*/</span>     </div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    </div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="comment">/* Configure LPTMR as timer in &#39;clear CNR in compare&#39; mode*/</span> </div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    LPTMR0-&gt;CSR = ( LPTMR_CSR_TCF_MASK | LPTMR_CSR_TIE_MASK );</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    LPTMR0-&gt;PSR = ( LPTMR_PSR_PCS( 0 ) | LPTMR_PSR_PBYP_MASK );         <span class="comment">/* Set 32kHz MCGIRCLK clock source. No prescaler selected */</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    LPTMR0-&gt;CMR = LPTMR_CMR_COMPARE( <a class="code" href="zumo__led_array_8h.html#ac6e759c50dde8c23dc207b2e0ab6a5e2">LA_LPTMR_DELAY_CAP_DISCHARGE</a> );</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="comment">/* Enable interrupt*/</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    NVIC_ClearPendingIRQ(LPTimer_IRQn);     <span class="comment">/* Clear any pending interrupt */</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    NVIC_EnableIRQ(LPTimer_IRQn);</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;        </div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    LPTMR0-&gt;CSR |=  LPTMR_CSR_TEN_MASK;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;}</div>
<div class="ttc" id="zumo__led_array_8c_html_ac9c0f431d82c25c370d7fad51661b211"><div class="ttname"><a href="zumo__led_array_8c.html#ac9c0f431d82c25c370d7fad51661b211">la_pins_as_outputs_and_high</a></div><div class="ttdeci">void la_pins_as_outputs_and_high(void)</div><div class="ttdoc">Function sets pins as outputs and disables interrupts. </div><div class="ttdef"><b>Definition:</b> zumo_ledArray.c:95</div></div>
<div class="ttc" id="zumo__led_array_8h_html_ac6e759c50dde8c23dc207b2e0ab6a5e2"><div class="ttname"><a href="zumo__led_array_8h.html#ac6e759c50dde8c23dc207b2e0ab6a5e2">LA_LPTMR_DELAY_CAP_DISCHARGE</a></div><div class="ttdeci">#define LA_LPTMR_DELAY_CAP_DISCHARGE</div><div class="ttdoc">Number of periods 32kHz square wave enough to discharge capacitors. </div><div class="ttdef"><b>Definition:</b> zumo_ledArray.h:21</div></div>
<div class="ttc" id="zumo__led_array_8c_html_a337d6814f1a3b2d1d6b365d75c34e3ef"><div class="ttname"><a href="zumo__led_array_8c.html#a337d6814f1a3b2d1d6b365d75c34e3ef">la_pins_init</a></div><div class="ttdeci">void la_pins_init(void)</div><div class="ttdoc">This function prepares LED array pins (multiplexers, pull-up/pull-down resistors, NVIC) ...</div><div class="ttdef"><b>Definition:</b> zumo_ledArray.c:49</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a73600f9119563ff029a79b4a9d4d077f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void la_pins_as_inputs </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>As the name suggests, function sets pins as inputs and enables interrupts. </p>
<div class="fragment"><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;                            {</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    </div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    FPTA-&gt;PDDR &amp;= ~( (1ul&lt;&lt;4) | (1ul&lt;&lt;5) );</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    FPTC-&gt;PDDR &amp;= ~( (1ul&lt;&lt;1) | (1ul&lt;&lt;2) );</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    FPTD-&gt;PDDR &amp;= ~( (1ul&lt;&lt;3) | (1ul&lt;&lt;6) );</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    </div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="comment">// Enable the interrupts</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    PORTA-&gt;PCR[4] |= PORT_PCR_IRQC(10);   <span class="comment">// Interrupt on falling edge</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    PORTC-&gt;PCR[1] |= PORT_PCR_IRQC(10);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    PORTD-&gt;PCR[6] |= PORT_PCR_IRQC(10);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    PORTC-&gt;PCR[2] |= PORT_PCR_IRQC(10);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    PORTD-&gt;PCR[3] |= PORT_PCR_IRQC(10);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    PORTA-&gt;PCR[5] |= PORT_PCR_IRQC(10);     </div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac9c0f431d82c25c370d7fad51661b211"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void la_pins_as_outputs_and_high </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function sets pins as outputs and disables interrupts. </p>
<div class="fragment"><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                                      {</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    </div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="comment">// Disable the interrupts</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    PORTA-&gt;PCR[4] &amp;= ~PORT_PCR_IRQC_MASK;       <span class="comment">// left side (top view)</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    PORTC-&gt;PCR[1] &amp;= ~PORT_PCR_IRQC_MASK;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    PORTD-&gt;PCR[6] &amp;= ~PORT_PCR_IRQC_MASK;       </div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    PORTC-&gt;PCR[2] &amp;= ~PORT_PCR_IRQC_MASK;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    PORTD-&gt;PCR[3] &amp;= ~PORT_PCR_IRQC_MASK;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    PORTA-&gt;PCR[5] &amp;= ~PORT_PCR_IRQC_MASK;       <span class="comment">// right side (top view)</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        </div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    FPTA-&gt;PDDR |= (1ul&lt;&lt;4) | (1ul&lt;&lt;5);</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    FPTC-&gt;PDDR |= (1ul&lt;&lt;1) | (1ul&lt;&lt;2);</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    FPTD-&gt;PDDR |= (1ul&lt;&lt;3) | (1ul&lt;&lt;6);</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    </div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    FPTA-&gt;PSOR |= (1ul&lt;&lt;4) | (1ul&lt;&lt;5);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    FPTC-&gt;PSOR |= (1ul&lt;&lt;1) | (1ul&lt;&lt;2);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    FPTD-&gt;PSOR |= (1ul&lt;&lt;3) | (1ul&lt;&lt;6);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a337d6814f1a3b2d1d6b365d75c34e3ef"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void la_pins_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function prepares LED array pins (multiplexers, pull-up/pull-down resistors, NVIC) </p>
<div class="fragment"><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;                       {</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    </div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="comment">// </span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    SIM-&gt;SCGC5 |= SIM_SCGC5_PORTA_MASK | SIM_SCGC5_PORTC_MASK | SIM_SCGC5_PORTD_MASK;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    PORTA-&gt;PCR[4] &amp;= ~PORT_PCR_MUX_MASK;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    PORTC-&gt;PCR[1] &amp;= ~PORT_PCR_MUX_MASK;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    PORTD-&gt;PCR[6] &amp;= ~PORT_PCR_MUX_MASK;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    PORTC-&gt;PCR[2] &amp;= ~PORT_PCR_MUX_MASK;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    PORTD-&gt;PCR[3] &amp;= ~PORT_PCR_MUX_MASK;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    PORTA-&gt;PCR[5] &amp;= ~PORT_PCR_MUX_MASK;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    PORTA-&gt;PCR[4] |= PORT_PCR_MUX(1);</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    PORTC-&gt;PCR[1] |= PORT_PCR_MUX(1);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    PORTD-&gt;PCR[6] |= PORT_PCR_MUX(1);</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    PORTC-&gt;PCR[2] |= PORT_PCR_MUX(1);</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    PORTD-&gt;PCR[3] |= PORT_PCR_MUX(1);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    PORTA-&gt;PCR[5] |= PORT_PCR_MUX(1);   </div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    PORTA-&gt;PCR[4] &amp;= ~(PORT_PCR_PE_MASK | PORT_PCR_PS_MASK);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    PORTC-&gt;PCR[1] &amp;= ~(PORT_PCR_PE_MASK | PORT_PCR_PS_MASK);</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    PORTD-&gt;PCR[6] &amp;= ~(PORT_PCR_PE_MASK | PORT_PCR_PS_MASK);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    PORTC-&gt;PCR[2] &amp;= ~(PORT_PCR_PE_MASK | PORT_PCR_PS_MASK);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    PORTD-&gt;PCR[3] &amp;= ~(PORT_PCR_PE_MASK | PORT_PCR_PS_MASK);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    PORTA-&gt;PCR[5] &amp;= ~(PORT_PCR_PE_MASK | PORT_PCR_PS_MASK);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        </div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    NVIC_ClearPendingIRQ(PORTC_PORTD_IRQn);             <span class="comment">/* Clear NVIC any pending interrupts on PORTC_D */</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    NVIC_ClearPendingIRQ(PORTA_IRQn);               <span class="comment">/* Clear NVIC any pending interrupts on PORTC_A */</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    NVIC_EnableIRQ(PORTC_PORTD_IRQn);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    NVIC_EnableIRQ(PORTA_IRQn);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a32c7d6b84769f952cd6c7759209482ef"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void la_startCal </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function sets calibration flag. </p>
<div class="fragment"><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;                      {</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <a class="code" href="zumo__led_array_8c.html#a59dceca9de5c44458070062ca7a68c95">cal_flag</a> = 1;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;}</div>
<div class="ttc" id="zumo__led_array_8c_html_a59dceca9de5c44458070062ca7a68c95"><div class="ttname"><a href="zumo__led_array_8c.html#a59dceca9de5c44458070062ca7a68c95">cal_flag</a></div><div class="ttdeci">volatile uint8_t cal_flag</div><div class="ttdef"><b>Definition:</b> zumo_ledArray.c:20</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a80842c42e85101e1d714a753aba9952a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void la_stopCal </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function clears calibration flag. </p>
<div class="fragment"><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;                     {</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <a class="code" href="zumo__led_array_8c.html#a59dceca9de5c44458070062ca7a68c95">cal_flag</a> = 0;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;}</div>
<div class="ttc" id="zumo__led_array_8c_html_a59dceca9de5c44458070062ca7a68c95"><div class="ttname"><a href="zumo__led_array_8c.html#a59dceca9de5c44458070062ca7a68c95">cal_flag</a></div><div class="ttdeci">volatile uint8_t cal_flag</div><div class="ttdef"><b>Definition:</b> zumo_ledArray.c:20</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1fa2da1558b73250cfb07ab3dedfcf1f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void LPTimer_IRQHandler </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function changes sensor pins direction. It works after charging sensor capacitors. </p>
<div class="fragment"><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                             {      </div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <a class="code" href="zumo__led_array_8c.html#ac9c0f431d82c25c370d7fad51661b211">la_pins_as_outputs_and_high</a>();</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    LPTMR0-&gt;CSR |=  LPTMR_CSR_TCF_MASK;                                     <span class="comment">// Clear interrupt flag</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <a class="code" href="zumo__led_array_8c.html#a7caaad9cec5c5d2faaadc1fee71db81f">lptimer_reload</a>( <a class="code" href="zumo__led_array_8h.html#a027e5ea6c985b69b515b3793888858ef">LA_LPTMR_DELAY_CAP_MAX_CHARGE</a> );        <span class="comment">// Set maximum discharge time. If everything is ok it is useless.</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <a class="code" href="zumo__led_array_8c.html#a73600f9119563ff029a79b4a9d4d077f">la_pins_as_inputs</a>();</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;}</div>
<div class="ttc" id="zumo__led_array_8c_html_a73600f9119563ff029a79b4a9d4d077f"><div class="ttname"><a href="zumo__led_array_8c.html#a73600f9119563ff029a79b4a9d4d077f">la_pins_as_inputs</a></div><div class="ttdeci">void la_pins_as_inputs(void)</div><div class="ttdoc">As the name suggests, function sets pins as inputs and enables interrupts. </div><div class="ttdef"><b>Definition:</b> zumo_ledArray.c:80</div></div>
<div class="ttc" id="zumo__led_array_8c_html_ac9c0f431d82c25c370d7fad51661b211"><div class="ttname"><a href="zumo__led_array_8c.html#ac9c0f431d82c25c370d7fad51661b211">la_pins_as_outputs_and_high</a></div><div class="ttdeci">void la_pins_as_outputs_and_high(void)</div><div class="ttdoc">Function sets pins as outputs and disables interrupts. </div><div class="ttdef"><b>Definition:</b> zumo_ledArray.c:95</div></div>
<div class="ttc" id="zumo__led_array_8h_html_a027e5ea6c985b69b515b3793888858ef"><div class="ttname"><a href="zumo__led_array_8h.html#a027e5ea6c985b69b515b3793888858ef">LA_LPTMR_DELAY_CAP_MAX_CHARGE</a></div><div class="ttdeci">#define LA_LPTMR_DELAY_CAP_MAX_CHARGE</div><div class="ttdoc">Maximum number of periods 32kHz square wave enough to charge capacitors. It is used only if some sens...</div><div class="ttdef"><b>Definition:</b> zumo_ledArray.h:26</div></div>
<div class="ttc" id="zumo__led_array_8c_html_a7caaad9cec5c5d2faaadc1fee71db81f"><div class="ttname"><a href="zumo__led_array_8c.html#a7caaad9cec5c5d2faaadc1fee71db81f">lptimer_reload</a></div><div class="ttdeci">void lptimer_reload(uint16_t time)</div><div class="ttdoc">This function resets LPTMR and set time value. </div><div class="ttdef"><b>Definition:</b> zumo_ledArray.c:114</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7caaad9cec5c5d2faaadc1fee71db81f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lptimer_reload </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>time</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function resets LPTMR and set time value. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">time</td><td>This value will be writtenn to LPTMR_CMR_COMPARE register </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                                    {</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    </div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    LPTMR0-&gt;CSR &amp;= ~( LPTMR_CSR_TEN_MASK | LPTMR_CSR_TIE_MASK );            <span class="comment">/* Disable timer to clear timer register*/</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    LPTMR0-&gt;CMR = LPTMR_CMR_COMPARE( time );    </div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    LPTMR0-&gt;CSR |=  LPTMR_CSR_TEN_MASK | LPTMR_CSR_TIE_MASK; <span class="comment">/* Enable LPTMR timer and interupt */</span>  </div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae01b365de69142666b470757d24fae84"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PORTA_IRQHandler </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Voltage drop function for two sensors. </p>
<p>This functions works simply. It decides which sensor has triggered the interrupt. Reads it's time and saves it in array. When voltage on each sensor has dropped it reloads timer and sensor counter and calculates state of sensors. </p>
<div class="fragment"><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                           {</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    </div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keywordflow">if</span>( PORTA-&gt;PCR[4] &amp; PORT_PCR_ISF_MASK ){</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        (<a class="code" href="zumo__led_array_8c.html#aac67b44fd8522f1794cc20210b6e30b9">ledArr</a>+0)-&gt;value = <a class="code" href="zumo__led_array_8c.html#a6564668e00e247cccee27f78d4ee5741">la_getLptmrCNR</a>();                   <span class="comment">// Read time of discharge</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        PORTA-&gt;PCR[4] |= PORT_PCR_ISF_MASK;                     <span class="comment">// Clear interrupt flag</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <a class="code" href="zumo__led_array_8c.html#ace4be061e8699df0061b24a48ccbbe3c">measured</a>++;                                                                     <span class="comment">// Increment counter of readed</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    }</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( PORTA-&gt;PCR[5] &amp; PORT_PCR_ISF_MASK ){</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        </div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        (<a class="code" href="zumo__led_array_8c.html#aac67b44fd8522f1794cc20210b6e30b9">ledArr</a>+5)-&gt;value = <a class="code" href="zumo__led_array_8c.html#a6564668e00e247cccee27f78d4ee5741">la_getLptmrCNR</a>();</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        PORTA-&gt;PCR[5] |= PORT_PCR_ISF_MASK;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <a class="code" href="zumo__led_array_8c.html#ace4be061e8699df0061b24a48ccbbe3c">measured</a>++;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    }</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    </div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="comment">// If each sensor has been readed...</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="zumo__led_array_8c.html#ace4be061e8699df0061b24a48ccbbe3c">measured</a> == 6 ){</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        </div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <a class="code" href="zumo__led_array_8c.html#ace4be061e8699df0061b24a48ccbbe3c">measured</a> = 0;                                                                           <span class="comment">// Reset the counter</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        <a class="code" href="zumo__led_array_8c.html#ac9c0f431d82c25c370d7fad51661b211">la_pins_as_outputs_and_high</a>();                                      <span class="comment">// Discharge capacitors</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        <a class="code" href="zumo__led_array_8c.html#a7caaad9cec5c5d2faaadc1fee71db81f">lptimer_reload</a>( <a class="code" href="zumo__led_array_8h.html#ac6e759c50dde8c23dc207b2e0ab6a5e2">LA_LPTMR_DELAY_CAP_DISCHARGE</a> );         <span class="comment">// Set Discharge time</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        </div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <span class="comment">// If calibration is set</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="zumo__led_array_8c.html#a59dceca9de5c44458070062ca7a68c95">cal_flag</a> == 1 ) <a class="code" href="zumo__led_array_8c.html#aaecbd2d7dc60340959cb832b0a936b15">la_calibrateMinMax</a>( <a class="code" href="zumo__led_array_8c.html#aac67b44fd8522f1794cc20210b6e30b9">ledArr</a> );   <span class="comment">// calibrate the sensors</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        </div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        <a class="code" href="zumo__led_array_8c.html#ac65cc9d437fc4e52a79dc15761c46f40">valid_data</a> = 0;                                                                     <span class="comment">// Set &#39;semaphore&#39;</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <a class="code" href="zumo__led_array_8c.html#a67a3e53e87d294ef560c6ab98805c51b">la_state</a> = <a class="code" href="zumo__led_array_8c.html#a14acac7e08664c3b6255ac7391eb09d4">la_calculateSensorState</a>( <a class="code" href="zumo__led_array_8c.html#aac67b44fd8522f1794cc20210b6e30b9">ledArr</a> );           <span class="comment">// Calculate each sensor status</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <a class="code" href="zumo__led_array_8c.html#ac65cc9d437fc4e52a79dc15761c46f40">valid_data</a> = 1;                                                                     <span class="comment">// Release &#39;semaphore&#39;</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    }</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;}</div>
<div class="ttc" id="zumo__led_array_8c_html_a59dceca9de5c44458070062ca7a68c95"><div class="ttname"><a href="zumo__led_array_8c.html#a59dceca9de5c44458070062ca7a68c95">cal_flag</a></div><div class="ttdeci">volatile uint8_t cal_flag</div><div class="ttdef"><b>Definition:</b> zumo_ledArray.c:20</div></div>
<div class="ttc" id="zumo__led_array_8c_html_ac9c0f431d82c25c370d7fad51661b211"><div class="ttname"><a href="zumo__led_array_8c.html#ac9c0f431d82c25c370d7fad51661b211">la_pins_as_outputs_and_high</a></div><div class="ttdeci">void la_pins_as_outputs_and_high(void)</div><div class="ttdoc">Function sets pins as outputs and disables interrupts. </div><div class="ttdef"><b>Definition:</b> zumo_ledArray.c:95</div></div>
<div class="ttc" id="zumo__led_array_8c_html_a67a3e53e87d294ef560c6ab98805c51b"><div class="ttname"><a href="zumo__led_array_8c.html#a67a3e53e87d294ef560c6ab98805c51b">la_state</a></div><div class="ttdeci">volatile char la_state</div><div class="ttdef"><b>Definition:</b> zumo_ledArray.c:18</div></div>
<div class="ttc" id="zumo__led_array_8h_html_ac6e759c50dde8c23dc207b2e0ab6a5e2"><div class="ttname"><a href="zumo__led_array_8h.html#ac6e759c50dde8c23dc207b2e0ab6a5e2">LA_LPTMR_DELAY_CAP_DISCHARGE</a></div><div class="ttdeci">#define LA_LPTMR_DELAY_CAP_DISCHARGE</div><div class="ttdoc">Number of periods 32kHz square wave enough to discharge capacitors. </div><div class="ttdef"><b>Definition:</b> zumo_ledArray.h:21</div></div>
<div class="ttc" id="zumo__led_array_8c_html_a14acac7e08664c3b6255ac7391eb09d4"><div class="ttname"><a href="zumo__led_array_8c.html#a14acac7e08664c3b6255ac7391eb09d4">la_calculateSensorState</a></div><div class="ttdeci">char la_calculateSensorState(volatile la_sensor_t *sensor_array)</div><div class="ttdoc">This function decides which colour is under each sensor (1 means dark/black) </div><div class="ttdef"><b>Definition:</b> zumo_ledArray.c:146</div></div>
<div class="ttc" id="zumo__led_array_8c_html_ace4be061e8699df0061b24a48ccbbe3c"><div class="ttname"><a href="zumo__led_array_8c.html#ace4be061e8699df0061b24a48ccbbe3c">measured</a></div><div class="ttdeci">volatile uint8_t measured</div><div class="ttdef"><b>Definition:</b> zumo_ledArray.c:19</div></div>
<div class="ttc" id="zumo__led_array_8c_html_ac65cc9d437fc4e52a79dc15761c46f40"><div class="ttname"><a href="zumo__led_array_8c.html#ac65cc9d437fc4e52a79dc15761c46f40">valid_data</a></div><div class="ttdeci">volatile uint8_t valid_data</div><div class="ttdef"><b>Definition:</b> zumo_ledArray.c:21</div></div>
<div class="ttc" id="zumo__led_array_8c_html_a6564668e00e247cccee27f78d4ee5741"><div class="ttname"><a href="zumo__led_array_8c.html#a6564668e00e247cccee27f78d4ee5741">la_getLptmrCNR</a></div><div class="ttdeci">uint16_t la_getLptmrCNR(void)</div><div class="ttdoc">This function reads CNR register. </div><div class="ttdef"><b>Definition:</b> zumo_ledArray.c:121</div></div>
<div class="ttc" id="zumo__led_array_8c_html_aac67b44fd8522f1794cc20210b6e30b9"><div class="ttname"><a href="zumo__led_array_8c.html#aac67b44fd8522f1794cc20210b6e30b9">ledArr</a></div><div class="ttdeci">volatile la_sensor_t ledArr[6]</div><div class="ttdef"><b>Definition:</b> zumo_ledArray.c:17</div></div>
<div class="ttc" id="zumo__led_array_8c_html_aaecbd2d7dc60340959cb832b0a936b15"><div class="ttname"><a href="zumo__led_array_8c.html#aaecbd2d7dc60340959cb832b0a936b15">la_calibrateMinMax</a></div><div class="ttdeci">void la_calibrateMinMax(volatile la_sensor_t *sensor_array)</div><div class="ttdoc">This function decides which colour is under each sensor (1 means dark/black) </div><div class="ttdef"><b>Definition:</b> zumo_ledArray.c:129</div></div>
<div class="ttc" id="zumo__led_array_8c_html_a7caaad9cec5c5d2faaadc1fee71db81f"><div class="ttname"><a href="zumo__led_array_8c.html#a7caaad9cec5c5d2faaadc1fee71db81f">lptimer_reload</a></div><div class="ttdeci">void lptimer_reload(uint16_t time)</div><div class="ttdoc">This function resets LPTMR and set time value. </div><div class="ttdef"><b>Definition:</b> zumo_ledArray.c:114</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a29e8c9a419cbde7a01f2d5664f59dce9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PORTC_PORTD_IRQHandler </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Voltage drop function for four sensors. </p>
<p>It works like <a class="el" href="zumo__led_array_8c.html#ae01b365de69142666b470757d24fae84" title="Voltage drop function for two sensors. ">PORTA_IRQHandler</a> </p>
<div class="fragment"><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                                 {</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    </div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="keywordflow">if</span>( PORTD-&gt;PCR[6] &amp; PORT_PCR_ISF_MASK ){</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        </div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        (<a class="code" href="zumo__led_array_8c.html#aac67b44fd8522f1794cc20210b6e30b9">ledArr</a>+2)-&gt;value = <a class="code" href="zumo__led_array_8c.html#a6564668e00e247cccee27f78d4ee5741">la_getLptmrCNR</a>();</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        PORTD-&gt;PCR[6] |= PORT_PCR_ISF_MASK;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        <a class="code" href="zumo__led_array_8c.html#ace4be061e8699df0061b24a48ccbbe3c">measured</a>++;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    }</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( PORTC-&gt;PCR[2] &amp; PORT_PCR_ISF_MASK ){</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        </div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        (<a class="code" href="zumo__led_array_8c.html#aac67b44fd8522f1794cc20210b6e30b9">ledArr</a>+3)-&gt;value = <a class="code" href="zumo__led_array_8c.html#a6564668e00e247cccee27f78d4ee5741">la_getLptmrCNR</a>();</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        PORTC-&gt;PCR[2] |= PORT_PCR_ISF_MASK;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        <a class="code" href="zumo__led_array_8c.html#ace4be061e8699df0061b24a48ccbbe3c">measured</a>++;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    }</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( PORTC-&gt;PCR[1] &amp; PORT_PCR_ISF_MASK ){</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        (<a class="code" href="zumo__led_array_8c.html#aac67b44fd8522f1794cc20210b6e30b9">ledArr</a>+1)-&gt;value = <a class="code" href="zumo__led_array_8c.html#a6564668e00e247cccee27f78d4ee5741">la_getLptmrCNR</a>();</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        PORTC-&gt;PCR[1] |= PORT_PCR_ISF_MASK;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        <a class="code" href="zumo__led_array_8c.html#ace4be061e8699df0061b24a48ccbbe3c">measured</a>++;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    }</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( PORTD-&gt;PCR[3] &amp; PORT_PCR_ISF_MASK ){</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        </div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        (<a class="code" href="zumo__led_array_8c.html#aac67b44fd8522f1794cc20210b6e30b9">ledArr</a>+4)-&gt;value = <a class="code" href="zumo__led_array_8c.html#a6564668e00e247cccee27f78d4ee5741">la_getLptmrCNR</a>();</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        PORTD-&gt;PCR[3] |= PORT_PCR_ISF_MASK;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        <a class="code" href="zumo__led_array_8c.html#ace4be061e8699df0061b24a48ccbbe3c">measured</a>++;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    }</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    </div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="zumo__led_array_8c.html#ace4be061e8699df0061b24a48ccbbe3c">measured</a> == 6 ){</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        </div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        <a class="code" href="zumo__led_array_8c.html#ace4be061e8699df0061b24a48ccbbe3c">measured</a> = 0;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <a class="code" href="zumo__led_array_8c.html#ac9c0f431d82c25c370d7fad51661b211">la_pins_as_outputs_and_high</a>();</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        <a class="code" href="zumo__led_array_8c.html#a7caaad9cec5c5d2faaadc1fee71db81f">lptimer_reload</a>( <a class="code" href="zumo__led_array_8h.html#ac6e759c50dde8c23dc207b2e0ab6a5e2">LA_LPTMR_DELAY_CAP_DISCHARGE</a> );</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        </div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="zumo__led_array_8c.html#a59dceca9de5c44458070062ca7a68c95">cal_flag</a> == 1 ) <a class="code" href="zumo__led_array_8c.html#aaecbd2d7dc60340959cb832b0a936b15">la_calibrateMinMax</a>( <a class="code" href="zumo__led_array_8c.html#aac67b44fd8522f1794cc20210b6e30b9">ledArr</a> );</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        </div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        <a class="code" href="zumo__led_array_8c.html#ac65cc9d437fc4e52a79dc15761c46f40">valid_data</a> = 0;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <a class="code" href="zumo__led_array_8c.html#a67a3e53e87d294ef560c6ab98805c51b">la_state</a> = <a class="code" href="zumo__led_array_8c.html#a14acac7e08664c3b6255ac7391eb09d4">la_calculateSensorState</a>( <a class="code" href="zumo__led_array_8c.html#aac67b44fd8522f1794cc20210b6e30b9">ledArr</a> );</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        <a class="code" href="zumo__led_array_8c.html#ac65cc9d437fc4e52a79dc15761c46f40">valid_data</a> = 1;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    }</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;}</div>
<div class="ttc" id="zumo__led_array_8c_html_a59dceca9de5c44458070062ca7a68c95"><div class="ttname"><a href="zumo__led_array_8c.html#a59dceca9de5c44458070062ca7a68c95">cal_flag</a></div><div class="ttdeci">volatile uint8_t cal_flag</div><div class="ttdef"><b>Definition:</b> zumo_ledArray.c:20</div></div>
<div class="ttc" id="zumo__led_array_8c_html_ac9c0f431d82c25c370d7fad51661b211"><div class="ttname"><a href="zumo__led_array_8c.html#ac9c0f431d82c25c370d7fad51661b211">la_pins_as_outputs_and_high</a></div><div class="ttdeci">void la_pins_as_outputs_and_high(void)</div><div class="ttdoc">Function sets pins as outputs and disables interrupts. </div><div class="ttdef"><b>Definition:</b> zumo_ledArray.c:95</div></div>
<div class="ttc" id="zumo__led_array_8c_html_a67a3e53e87d294ef560c6ab98805c51b"><div class="ttname"><a href="zumo__led_array_8c.html#a67a3e53e87d294ef560c6ab98805c51b">la_state</a></div><div class="ttdeci">volatile char la_state</div><div class="ttdef"><b>Definition:</b> zumo_ledArray.c:18</div></div>
<div class="ttc" id="zumo__led_array_8h_html_ac6e759c50dde8c23dc207b2e0ab6a5e2"><div class="ttname"><a href="zumo__led_array_8h.html#ac6e759c50dde8c23dc207b2e0ab6a5e2">LA_LPTMR_DELAY_CAP_DISCHARGE</a></div><div class="ttdeci">#define LA_LPTMR_DELAY_CAP_DISCHARGE</div><div class="ttdoc">Number of periods 32kHz square wave enough to discharge capacitors. </div><div class="ttdef"><b>Definition:</b> zumo_ledArray.h:21</div></div>
<div class="ttc" id="zumo__led_array_8c_html_a14acac7e08664c3b6255ac7391eb09d4"><div class="ttname"><a href="zumo__led_array_8c.html#a14acac7e08664c3b6255ac7391eb09d4">la_calculateSensorState</a></div><div class="ttdeci">char la_calculateSensorState(volatile la_sensor_t *sensor_array)</div><div class="ttdoc">This function decides which colour is under each sensor (1 means dark/black) </div><div class="ttdef"><b>Definition:</b> zumo_ledArray.c:146</div></div>
<div class="ttc" id="zumo__led_array_8c_html_ace4be061e8699df0061b24a48ccbbe3c"><div class="ttname"><a href="zumo__led_array_8c.html#ace4be061e8699df0061b24a48ccbbe3c">measured</a></div><div class="ttdeci">volatile uint8_t measured</div><div class="ttdef"><b>Definition:</b> zumo_ledArray.c:19</div></div>
<div class="ttc" id="zumo__led_array_8c_html_ac65cc9d437fc4e52a79dc15761c46f40"><div class="ttname"><a href="zumo__led_array_8c.html#ac65cc9d437fc4e52a79dc15761c46f40">valid_data</a></div><div class="ttdeci">volatile uint8_t valid_data</div><div class="ttdef"><b>Definition:</b> zumo_ledArray.c:21</div></div>
<div class="ttc" id="zumo__led_array_8c_html_a6564668e00e247cccee27f78d4ee5741"><div class="ttname"><a href="zumo__led_array_8c.html#a6564668e00e247cccee27f78d4ee5741">la_getLptmrCNR</a></div><div class="ttdeci">uint16_t la_getLptmrCNR(void)</div><div class="ttdoc">This function reads CNR register. </div><div class="ttdef"><b>Definition:</b> zumo_ledArray.c:121</div></div>
<div class="ttc" id="zumo__led_array_8c_html_aac67b44fd8522f1794cc20210b6e30b9"><div class="ttname"><a href="zumo__led_array_8c.html#aac67b44fd8522f1794cc20210b6e30b9">ledArr</a></div><div class="ttdeci">volatile la_sensor_t ledArr[6]</div><div class="ttdef"><b>Definition:</b> zumo_ledArray.c:17</div></div>
<div class="ttc" id="zumo__led_array_8c_html_aaecbd2d7dc60340959cb832b0a936b15"><div class="ttname"><a href="zumo__led_array_8c.html#aaecbd2d7dc60340959cb832b0a936b15">la_calibrateMinMax</a></div><div class="ttdeci">void la_calibrateMinMax(volatile la_sensor_t *sensor_array)</div><div class="ttdoc">This function decides which colour is under each sensor (1 means dark/black) </div><div class="ttdef"><b>Definition:</b> zumo_ledArray.c:129</div></div>
<div class="ttc" id="zumo__led_array_8c_html_a7caaad9cec5c5d2faaadc1fee71db81f"><div class="ttname"><a href="zumo__led_array_8c.html#a7caaad9cec5c5d2faaadc1fee71db81f">lptimer_reload</a></div><div class="ttdeci">void lptimer_reload(uint16_t time)</div><div class="ttdoc">This function resets LPTMR and set time value. </div><div class="ttdef"><b>Definition:</b> zumo_ledArray.c:114</div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="a59dceca9de5c44458070062ca7a68c95"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile uint8_t cal_flag = 0</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Calibration flag which allow LED array to perfotm self-calibration </p>

</div>
</div>
<a class="anchor" id="a67a3e53e87d294ef560c6ab98805c51b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile char la_state</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Encoded status of each sensor (six last bits) </p>

</div>
</div>
<a class="anchor" id="aac67b44fd8522f1794cc20210b6e30b9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile <a class="el" href="structla__sensor__t.html">la_sensor_t</a> ledArr[6]</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Six sensors array </p>

</div>
</div>
<a class="anchor" id="ace4be061e8699df0061b24a48ccbbe3c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile uint8_t measured = 0</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Counter how many sensors has been readed </p>

</div>
</div>
<a class="anchor" id="ac65cc9d437fc4e52a79dc15761c46f40"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile uint8_t valid_data = 0</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Semaphore </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_b2f33c71d4aa5e7af42a1ca61ff5af1b.html">source</a></li><li class="navelem"><a class="el" href="zumo__led_array_8c.html">zumo_ledArray.c</a></li>
    <li class="footer">Generated on Sun May 31 2015 21:33:11 for My Project by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
